# دليل استخدام ميزة رفع ملف Excel لبنود العمل

## نظرة عامة
تم إضافة ميزة جديدة لرفع ملف Excel في قسم مقايسة الأعمال تتيح للمستخدمين:
- رفع ملف Excel/CSV يحتوي على بنود العمل
- قراءة البيانات تلقائياً وحفظها في قاعدة البيانات مع سعر الوحدة
- البحث في جميع بنود العمل المحفوظة
- إضافة البنود المختارة إلى أمر العمل الجديد

## تنسيق الملف المطلوب

### الخيار الأول: الأعمدة بالعربية (المفضل)
```
البند,الوصف الكامل,الوحدة,سعر الوحدة
WI001,حفر خنادق للكابلات الأرضية,متر طولي,150.50
WI002,تركيب كابلات كهربائية,متر طولي,200.75
```

### الخيار الثاني: الأعمدة بالإنجليزية
```
code,description,unit,unit_price
WI001,حفر خنادق للكابلات الأرضية,متر طولي,150.50
WI002,تركيب كابلات كهربائية,متر طولي,200.75
```

## الأعمدة المطلوبة

1. **كود العنصر** (البند/code/كود) - اختياري
   - إذا كان فارغاً، سيتم إنشاء كود تلقائياً
   - نص قصير (أقل من 50 حرف)

2. **الوصف** (الوصف الكامل/description/الوصف) - مطلوب
   - وصف تفصيلي للعنصر
   - نص (أقل من 500 حرف)

3. **الوحدة** (الوحدة/unit/وحدة) - اختياري
   - وحدة القياس (متر، عدد، كيلو، إلخ)
   - القيمة الافتراضية: "عدد"

4. **سعر الوحدة** (سعر الوحدة/unit_price/السعر) - اختياري
   - سعر الوحدة بالريال السعودي
   - رقم عشري (القيمة الافتراضية: 0)

## الأنواع المدعومة
- Excel (.xlsx, .xls)
- CSV (.csv)
- الحد الأقصى لحجم الملف: 10 ميجابايت

## خطوات الاستخدام

### 1. رفع ملف Excel
1. انتقل إلى صفحة إنشاء أمر عمل جديد
2. في قسم "مقايسة الأعمال"، اضغط على "رفع ملف Excel"
3. اختر الملف المطلوب
4. اضغط "رفع ومعالجة"
5. ستظهر رسالة تأكيد تُعلمك بعدد العناصر المستوردة

### 2. البحث في البنود
1. اضغط على "البحث في البنود"
2. استخدم مربع البحث للبحث في جميع الأعمدة
3. اضغط "إضافة" بجانب البند المطلوب
4. سيتم إضافة البند تلقائياً إلى جدول مقايسة الأعمال

### 3. إضافة بند يدوياً
- يمكنك أيضاً إضافة بنود يدوياً باستخدام زر "إضافة بند عمل"

## ملفات نموذجية
تم إنشاء ملفين نموذجيين يمكن استخدامهما للاختبار:
- `sample_work_items.csv` - بأعمدة عربية مع سعر الوحدة
- `sample_work_items_arabic.csv` - نموذج آخر بأعمدة عربية

## معالجة الأخطاء
- إذا كان الكود مكرر، سيتم تحديث البيانات الموجودة
- إذا كان الكود فارغاً، سيتم إنشاء كود تلقائياً
- الصفوف التي تحتوي على أخطاء سيتم تجاهلها
- ستظهر رسالة تفصيلية بعدد العناصر المستوردة والأخطاء إن وجدت

## الميزات الإضافية
- **البحث المباشر**: اكتب في مربع البحث واضغط Enter
- **عرض الأسعار**: يتم عرض سعر الوحدة في نتائج البحث
- **إدارة الكميات**: أدخل الكمية المخططة لكل بند
- **الملاحظات**: أضف ملاحظات خاصة لكل بند في أمر العمل
- **حذف البنود**: يمكن حذف أي بند من الجدول

## المتطلبات التقنية
- Laravel Excel package
- قاعدة بيانات MySQL مع حقل unit_price
- PHP 8.0+
- Bootstrap 5 للواجهة

## استكشاف الأخطاء
1. **خطأ في تنسيق الملف**: تأكد من وجود الأعمدة المطلوبة
2. **خطأ في الحجم**: تأكد أن الملف أقل من 10 ميجابايت
3. **خطأ في البيانات**: تأكد أن الوصف غير فارغ
4. **خطأ Importable trait**: تم حل هذه المشكلة بإزالة الـ trait غير المطلوب

---
تاريخ التحديث: 1 يونيو 2025
الإصدار: 2.0 - مع دعم سعر الوحدة 