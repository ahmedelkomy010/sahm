<template>
  <div style="color:red;font-size:2rem;">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø± Ù‡Ù†Ø§ (Vue Mount Test)</div>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th rowspan="2">Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠ</th>
          <th rowspan="2">URS</th>
          <th rowspan="2">ÙƒØ´Ù ÙØ³ÙˆØ­Ø§Øª Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„<br>Ø´Ø±ÙƒØ© Ø³Ù‡Ù… Ø¨Ù„Ø¯ÙŠ</th>
          <th rowspan="2">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th colspan="2">Ø§Ù„ÙØ³Ø­</th>
          <th colspan="3">Ù†ÙˆØ¹ Ø§Ù„Ø´Ø§Ø±Ø¹</th>
          <th rowspan="2">ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø®ØªØ¨Ø±</th>
          <th rowspan="2">Ø§Ù„Ø³Ù†Ø©</th>
          <th rowspan="2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„</th>
          <th rowspan="2">Ø¹Ù…Ù‚</th>
          <th rowspan="2">Ø¯Ùƒ Ø§Ù„ØªØ±Ø¨Ø©</th>
          <th rowspan="2">MC1RC2 Ø¯Ùƒ Ø£Ø³ÙÙ„Øª ÙˆØªØ±Ø§Ø¨ÙŠ</th>
          <th rowspan="2">Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ù‚ØµÙˆÙ‰ Ù„Ø£Ø³ÙÙ„Øª</th>
          <th rowspan="2">Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ÙÙ„Øª</th>
          <th rowspan="2">Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø­Ø¨ÙŠØ¨ÙŠ</th>
          <th rowspan="2">ØªØ¬Ø±Ø¨Ø© Ù…Ø§Ø±Ø´Ø§Ù„</th>
          <th rowspan="2">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¨Ù„Ø§Ø· ÙˆØ§Ù„Ø¨Ø±Ø¯ÙˆØ±Ø§Øª</th>
          <th rowspan="2">ØªØµÙ†ÙŠÙ Ø§Ù„ØªØ±Ø¨Ø©</th>
          <th rowspan="2">ØªØ¬Ø±Ø¨Ø© Ø¨Ø±ÙˆÙƒØªÙˆØ±</th>
          <th rowspan="2">Ø§Ù„Ø®Ø±Ø³Ø§Ù†Ø©</th>
          <th rowspan="2">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th rowspan="2">Ø­Ø°Ù</th>
        </tr>
        <tr>
          <th>Ø±Ù‚Ù… Ø§Ù„ÙØ³Ø­</th>
          <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ³Ø­</th>
          <th>ØªØ±Ø§Ø¨ÙŠ</th>
          <th>Ø£Ø³ÙÙ„Øª</th>
          <th>Ø¨Ù„Ø§Ø·</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(row, idx) in rows" :key="row.id || idx">
          <td><input v-model="row.consultant" /></td>
          <td><input v-model="row.urs" /></td>
          <td><input v-model="row.contractor" /></td>
          <td><input type="date" v-model="row.date" /></td>
          <td><input v-model="row.permit_no" /></td>
          <td><input type="date" v-model="row.permit_date" /></td>
          <td><input type="checkbox" v-model="row.street_type_terabi" /></td>
          <td><input type="checkbox" v-model="row.street_type_asphalt" /></td>
          <td><input type="checkbox" v-model="row.street_type_blat" /></td>
          <td><input v-model="row.lab_check" /></td>
          <td><input v-model="row.year" type="number" /></td>
          <td><input v-model="row.work_type" /></td>
          <td><input v-model="row.depth" type="number" /></td>
          <td><input v-model="row.soil_compaction" /></td>
          <td><input v-model="row.mc1rc2" /></td>
          <td><input v-model="row.max_density" /></td>
          <td><input v-model="row.asphalt_percent" /></td>
          <td><input v-model="row.gradation" /></td>
          <td><input v-model="row.marshall" /></td>
          <td><input v-model="row.tile_eval" /></td>
          <td><input v-model="row.soil_class" /></td>
          <td><input v-model="row.proctor" /></td>
          <td><input v-model="row.concrete" /></td>
          <td><input v-model="row.notes" /></td>
          <td>
            <button @click="removeRow(idx, row.id)">ğŸ—‘ï¸</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button @click="addRow">Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
    <button @click="saveRows">Ø­ÙØ¸</button>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const rows = ref([])

onMounted(async () => {
  const { data } = await axios.get('/api/lab-licenses')
  rows.value = data
})

function addRow() {
  rows.value.push({
    consultant: '', urs: '', contractor: '', date: '', permit_no: '', permit_date: '',
    street_type_terabi: false, street_type_asphalt: false, street_type_blat: false,
    lab_check: '', year: '', work_type: '', depth: '', soil_compaction: '', mc1rc2: '',
    max_density: '', asphalt_percent: '', gradation: '', marshall: '', tile_eval: '',
    soil_class: '', proctor: '', concrete: '', notes: ''
  })
}

async function saveRows() {
  for (const row of rows.value) {
    if (row.id) {
      await axios.put(`/api/lab-licenses/${row.id}`, row)
    } else {
      const { data } = await axios.post('/api/lab-licenses', row)
      row.id = data.id
    }
  }
  alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­')
}

async function removeRow(idx, id) {
  if (id) await axios.delete(`/api/lab-licenses/${id}`)
  rows.value.splice(idx, 1)
}
</script>

<style scoped>
.table-container { overflow-x: auto; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #007bff; color: #fff; }
button { margin: 5px; }
</style> 